# Neff-Paving Project Environment Configuration
# This file automatically loads the Nix development environment when entering the project directory
# Requires direnv to be installed and configured in your shell

# Load the Nix shell environment
use_nix() {
  local shell_file="shell.nix"
  if [[ ! -f "$shell_file" ]]; then
    echo "âŒ shell.nix not found in current directory"
    return 1
  fi
  
  echo "ğŸ”„ Loading Neff-Paving development environment..."
  eval "$(nix-shell --command 'echo "export PATH=\"$PATH\""' --run 'env' | grep -E '^(PATH|NODE_|NPM_|VITE_|PKG_CONFIG|PUPPETEER)' | sed 's/^/export /')"
  
  echo "âœ… Nix environment loaded successfully!"
}

# Use the Nix shell configuration
use nix

# Project-specific environment variables
export PROJECT_NAME="Neff-Paving"
export PROJECT_ROOT="$(pwd)"

# Development environment settings
export NODE_ENV="development"
export VITE_BASE_URL="/Neff-Paving/"
export VITE_PLATFORM="development"

# Server configuration
export SERVER_PORT="3001"
export VITE_DEV_PORT="3000"

# Google Maps API configuration (load from .env.local if exists)
if [[ -f ".env.local" ]]; then
  source .env.local
fi

# Add project binaries to PATH
PATH_add "node_modules/.bin"
PATH_add "server/node_modules/.bin"

# Shell aliases and functions
alias dev="npm run dev"
alias server="cd server && npm start"
alias build="npm run build"
alias preview="npm run preview"
alias deploy-gh="npm run deploy:github"
alias deploy-vc="npm run deploy:vercel"
alias install-all="npm install && cd server && npm install && cd .."

# Development helper functions
function start-dev() {
  echo "ğŸš€ Starting Neff-Paving development environment..."
  echo "ğŸ“± Frontend dev server will start on http://localhost:3000"
  echo "ğŸ–¥ï¸  Backend server will start on http://localhost:3001"
  
  # Start both servers in parallel
  npm run dev &
  (cd server && npm start) &
  
  echo "âœ… Both servers started! Press Ctrl+C to stop both."
  wait
}

function stop-dev() {
  echo "â¹ï¸  Stopping development servers..."
  pkill -f "vite"
  pkill -f "node server/server.js"
  echo "âœ… Development servers stopped."
}

# Print helpful information when environment loads
echo ""
echo "ğŸ—ï¸  Neff-Paving Development Environment"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“ Project: $PROJECT_NAME"
echo "ğŸ“‚ Root: $PROJECT_ROOT"
echo "ğŸŒ Dev URL: http://localhost:3000"
echo "ğŸ–¥ï¸  Server URL: http://localhost:3001"
echo ""
echo "ğŸ’¡ Quick commands:"
echo "   dev         - Start Vite dev server"
echo "   server      - Start estimate form server"
echo "   start-dev   - Start both servers"
echo "   build       - Build for production"
echo "   install-all - Install all dependencies"
echo ""
echo "ğŸ”§ Run 'npm run dev' to start development!"
echo ""
