<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neff Paving - Request Estimate</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="src/styles/estimate-form.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Oswald', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .page-header h1 {
            color: #2c2c2c;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .page-header p {
            color: #6b6b6b;
            font-size: 1.3rem;
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .page-header .company-info {
            margin-top: 1rem;
            color: #2c2c2c;
            font-weight: 500;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-content {
            text-align: center;
            color: #2c2c2c;
        }
        
        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 4px solid #e5e5e5;
            border-top: 4px solid #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .demo-controls {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 300px;
        }
        
        .demo-controls h3 {
            color: #2c2c2c;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        
        .demo-controls button {
            background: #ffd700;
            color: #2c2c2c;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.25rem;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }
        
        .demo-controls button:hover {
            background: #e6c200;
        }
        
        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 2.5rem;
            }
            
            .page-header p {
                font-size: 1.1rem;
            }
            
            .demo-controls {
                display: none;
            }
            
            body {
                padding: 1rem 0;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Loading estimate form...</p>
        </div>
    </div>
    
    <div class="page-header">
        <h1>Get Your Free Estimate</h1>
        <p>Professional paving services for residential and commercial projects across Central Ohio</p>
        <div class="company-info">
            Neff Paving • Licensed & Insured • 38+ Years Experience
        </div>
    </div>
    
    <div id="estimate-form-container">
        <!-- EstimateForm component will be rendered here -->
    </div>
    
    <!-- Demo Controls (for testing) -->
    <div class="demo-controls">
        <h3>Demo Controls</h3>
        <button onclick="simulateMeasurementData()">Add Measurement Data</button>
        <button onclick="fillSampleData()">Fill Sample Data</button>
        <button onclick="clearForm()">Clear Form</button>
        <button onclick="toggleValidation()">Toggle Validation</button>
    </div>
    
    <!-- Mock API endpoint for demonstration -->
    <script>
        // Mock API response for demonstration
        let mockApiDelay = 2000;
        let validationEnabled = true;
        
        // Override fetch for demo purposes
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            if (url === '/api/estimates' && options.method === 'POST') {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            ok: true,
                            json: () => Promise.resolve({
                                referenceNumber: 'EST-' + Date.now(),
                                estimate: {
                                    totalCost: Math.floor(Math.random() * 10000) + 5000
                                }
                            })
                        });
                    }, mockApiDelay);
                });
            }
            return originalFetch.apply(this, arguments);
        };
        
        // Demo helper functions
        function simulateMeasurementData() {
            // Simulate measurement data being stored
            const mockData = {
                googleMaps: {
                    areaInSquareFeet: 1250,
                    coordinates: [
                        {lat: 40.0583, lng: -82.4009},
                        {lat: 40.0585, lng: -82.4007},
                        {lat: 40.0582, lng: -82.4005},
                        {lat: 40.0580, lng: -82.4007}
                    ],
                    timestamp: new Date().toISOString()
                },
                activeTool: 'google-maps'
            };
            
            // Store in sessionStorage to simulate measurement tool integration
            sessionStorage.setItem('neff_paving_google_maps_measurements', JSON.stringify({
                data: mockData.googleMaps,
                timestamp: new Date().toISOString(),
                toolType: 'google-maps'
            }));
            
            sessionStorage.setItem('neff_paving_active_measurement_tool', 'google-maps');
            
            // Reload the form to show measurement data
            location.reload();
        }
        
        function fillSampleData() {
            // Fill form with sample data
            const form = document.getElementById('estimate-form');
            if (form) {
                form.querySelector('#firstName').value = 'John';
                form.querySelector('#lastName').value = 'Smith';
                form.querySelector('#email').value = 'john.smith@email.com';
                form.querySelector('#phone').value = '(614) 555-0123';
                form.querySelector('#serviceType').value = 'residential';
                form.querySelector('#timeline').value = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                form.querySelector('#projectDescription').value = 'Need new driveway installation. Current driveway is cracked and needs complete replacement.';
                form.querySelector('#streetAddress').value = '123 Main Street';
                form.querySelector('#city').value = 'Columbus';
                form.querySelector('#state').value = 'OH';
                form.querySelector('#zipCode').value = '43215';
                
                // Trigger events to update form state
                form.querySelectorAll('input, select, textarea').forEach(field => {
                    field.dispatchEvent(new Event('input', { bubbles: true }));
                });
            }
        }
        
        function clearForm() {
            const form = document.getElementById('estimate-form');
            if (form) {
                form.reset();
                
                // Clear measurement data
                sessionStorage.removeItem('neff_paving_google_maps_measurements');
                sessionStorage.removeItem('neff_paving_arcgis_measurements');
                sessionStorage.removeItem('neff_paving_active_measurement_tool');
                
                // Clear validation errors
                document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
                document.querySelectorAll('.form-input, .form-select, .form-textarea').forEach(el => {
                    el.classList.remove('error');
                });
            }
        }
        
        function toggleValidation() {
            validationEnabled = !validationEnabled;
            alert(`Validation ${validationEnabled ? 'enabled' : 'disabled'}`);
        }
    </script>
    
    <!-- Load the EstimateForm component -->
    <script type="module">
        import EstimateForm from './src/components/estimate-form.js';
        
        // Show loading overlay
        document.getElementById('loading-overlay').classList.add('show');
        
        // Initialize form after a short delay to simulate loading
        setTimeout(() => {
            try {
                const estimateForm = new EstimateForm('estimate-form-container');
                console.log('EstimateForm initialized successfully');
            } catch (error) {
                console.error('Failed to initialize EstimateForm:', error);
                
                // Show error message
                document.getElementById('estimate-form-container').innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #e74c3c;">
                        <h2>Error Loading Form</h2>
                        <p>Please refresh the page to try again.</p>
                        <p style="font-size: 0.9rem; margin-top: 1rem;">Error: ${error.message}</p>
                    </div>
                `;
            }
            
            // Hide loading overlay
            document.getElementById('loading-overlay').classList.remove('show');
        }, 1000);
        
        // Handle page visibility changes
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                // Page became visible, check for updated measurement data
                if (window.estimateFormInstance) {
                    window.estimateFormInstance.loadMeasurementData();
                }
            }
        });
    </script>
</body>
</html>
