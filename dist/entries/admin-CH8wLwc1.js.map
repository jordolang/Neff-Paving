{"version":3,"file":"admin-CH8wLwc1.js","sources":["../../admin/admin.js"],"sourcesContent":["class AdminDashboard {\n    constructor() {\n        // Use production URL when deployed to Vercel, localhost for development\n        this.apiBase = window.location.hostname === 'localhost' \n            ? 'http://localhost:8001/api'\n            : `${window.location.protocol}//${window.location.hostname}/api`;\n        this.token = localStorage.getItem('admin_token');\n        this.currentSection = 'dashboard';\n        \n        this.init();\n    }\n\n    async init() {\n        if (!this.token) {\n            this.showLogin();\n            return;\n        }\n\n        try {\n            await this.verifyToken();\n            this.showDashboard();\n        } catch (error) {\n            console.error('Authentication failed:', error);\n            this.showLogin();\n        }\n    }\n\n    async verifyToken() {\n        const response = await fetch(`${this.apiBase}/auth/verify`, {\n            headers: {\n                'Authorization': `Bearer ${this.token}`\n            }\n        });\n\n        if (!response.ok) {\n            throw new Error('Token verification failed');\n        }\n\n        return response.json();\n    }\n\n    showLogin() {\n        document.getElementById('login-screen').style.display = 'block';\n        document.getElementById('admin-dashboard').style.display = 'none';\n        \n        const loginForm = document.getElementById('login-form');\n        if (loginForm) {\n            loginForm.addEventListener('submit', (e) => this.handleLogin(e));\n        }\n    }\n\n    showDashboard() {\n        document.getElementById('login-screen').style.display = 'none';\n        document.getElementById('admin-dashboard').style.display = 'block';\n        \n        this.setupEventListeners();\n        this.showSection('dashboard');\n        this.loadDashboardData();\n    }\n\n    async handleLogin(e) {\n        e.preventDefault();\n        \n        const formData = new FormData(e.target);\n        const credentials = {\n            username: formData.get('username'),\n            password: formData.get('password')\n        };\n\n        try {\n            const response = await fetch(`${this.apiBase}/auth/login`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(credentials)\n            });\n\n            const result = await response.json();\n\n            if (result.success) {\n                localStorage.setItem('admin_token', result.token);\n                this.token = result.token;\n                this.showDashboard();\n            } else {\n                alert('Login failed: ' + result.message);\n            }\n        } catch (error) {\n            console.error('Login error:', error);\n            alert('Login failed. Please try again.');\n        }\n    }\n\n    setupEventListeners() {\n        // Menu navigation\n        document.querySelectorAll('[data-section]').forEach(link => {\n            link.addEventListener('click', (e) => {\n                e.preventDefault();\n                const section = e.target.getAttribute('data-section') || e.target.closest('[data-section]').getAttribute('data-section');\n                this.showSection(section);\n            });\n        });\n    }\n\n    showSection(sectionName) {\n        // Hide all sections\n        document.querySelectorAll('.content-section').forEach(section => {\n            section.classList.remove('active');\n        });\n\n        // Show selected section\n        const targetSection = document.getElementById(`${sectionName}-section`);\n        if (targetSection) {\n            targetSection.classList.add('active');\n        }\n\n        // Update active nav item\n        document.querySelectorAll('.sidebar .nav-link').forEach(link => {\n            link.classList.remove('active');\n        });\n        \n        const activeNavLink = document.querySelector(`[data-section=\"${sectionName}\"]`);\n        if (activeNavLink) {\n            activeNavLink.classList.add('active');\n        }\n\n        this.currentSection = sectionName;\n\n        // Load section data\n        switch(sectionName) {\n            case 'dashboard':\n                this.loadDashboardData();\n                break;\n            case 'estimates':\n                this.loadEstimates();\n                break;\n            case 'jobs':\n                this.loadJobs();\n                break;\n            case 'customers':\n                this.loadCustomers();\n                break;\n            case 'maps':\n                this.loadMaps();\n                break;\n            case 'blog-posts':\n            case 'blog-all-posts':\n            case 'blog-add-new':\n            case 'blog-categories':\n                this.loadBlogSection(sectionName);\n                break;\n        }\n    }\n\n    async loadDashboardData() {\n        try {\n            const [statsResponse, activitiesResponse] = await Promise.all([\n                fetch(`${this.apiBase}/admin/dashboard/stats`, {\n                    headers: { 'Authorization': `Bearer ${this.token}` }\n                }),\n                fetch(`${this.apiBase}/admin/dashboard/activities`, {\n                    headers: { 'Authorization': `Bearer ${this.token}` }\n                })\n            ]);\n\n            const stats = await statsResponse.json();\n            const activities = await activitiesResponse.json();\n\n            if (stats.success) {\n                document.getElementById('pending-estimates').textContent = stats.data.pendingEstimates;\n                document.getElementById('active-jobs').textContent = stats.data.activeProjects;\n                document.getElementById('total-revenue').textContent = `$${stats.data.revenue.toLocaleString()}`;\n                document.getElementById('total-projects').textContent = stats.data.totalProjects;\n            }\n\n            if (activities.success) {\n                this.renderActivities(activities.data);\n            }\n        } catch (error) {\n            console.error('Error loading dashboard data:', error);\n        }\n    }\n\n    renderActivities(activities) {\n        const container = document.getElementById('recent-activities');\n        \n        if (activities.length === 0) {\n            container.innerHTML = '<p class=\"text-muted\">No recent activities</p>';\n            return;\n        }\n\n        container.innerHTML = activities.map(activity => `\n            <div class=\"d-flex align-items-center mb-3 p-3 border rounded\">\n                <div class=\"avatar-initial bg-label-${activity.status === 'completed' ? 'success' : 'warning'} me-3\">\n                    ${activity.type === 'estimate_request' ? 'üìã' : '‚öíÔ∏è'}\n                </div>\n                <div class=\"flex-grow-1\">\n                    <div class=\"fw-semibold\">${activity.message}</div>\n                    <small class=\"text-muted\">${new Date(activity.timestamp).toLocaleDateString()}</small>\n                </div>\n                <span class=\"badge bg-${activity.status === 'completed' ? 'success' : 'warning'}\">${activity.status}</span>\n            </div>\n        `).join('');\n    }\n\n    async loadEstimates() {\n        try {\n            const response = await fetch(`${this.apiBase}/estimates`, {\n                headers: { 'Authorization': `Bearer ${this.token}` }\n            });\n\n            const result = await response.json();\n            \n            if (result.success) {\n                this.renderEstimates(result.data);\n            }\n        } catch (error) {\n            console.error('Error loading estimates:', error);\n            document.getElementById('estimates-table').innerHTML = '<tr><td colspan=\"6\" class=\"text-center text-muted\">Error loading estimates</td></tr>';\n        }\n    }\n\n    renderEstimates(estimates) {\n        const tbody = document.getElementById('estimates-table');\n        \n        if (estimates.length === 0) {\n            tbody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center text-muted\">No estimates found</td></tr>';\n            return;\n        }\n\n        tbody.innerHTML = estimates.map(estimate => `\n            <tr>\n                <td>\n                    <div class=\"fw-semibold\">${estimate.firstName} ${estimate.lastName}</div>\n                    <small class=\"text-muted\">${estimate.email}</small>\n                </td>\n                <td><span class=\"badge bg-primary\">${estimate.serviceType}</span></td>\n                <td><small>${estimate.projectAddress || 'N/A'}</small></td>\n                <td>${estimate.projectSize || 'N/A'}</td>\n                <td><span class=\"badge bg-${estimate.status === 'pending' ? 'warning' : 'success'}\">${estimate.status}</span></td>\n                <td>\n                    <button class=\"btn btn-sm btn-outline-primary\" onclick=\"adminDashboard.viewEstimate('${estimate.id}')\">View</button>\n                    ${estimate.areaData ? `<button class=\"btn btn-sm btn-outline-info ms-1\" onclick=\"adminDashboard.viewArea('${estimate.id}')\">Area</button>` : ''}\n                </td>\n            </tr>\n        `).join('');\n    }\n\n    async loadJobs() {\n        // Placeholder for jobs functionality\n        console.log('Loading jobs...');\n    }\n\n    async loadCustomers() {\n        // Placeholder for customers functionality\n        console.log('Loading customers...');\n    }\n\n    loadMaps() {\n        // Placeholder for maps functionality\n        console.log('Loading maps...');\n    }\n\n    async loadBlogSection(sectionName) {\n        // Load blog manager if not already loaded\n        if (!window.blogManager) {\n            await this.loadBlogManager();\n        }\n        \n        // Load specific blog section data\n        if (window.blogManager) {\n            switch(sectionName) {\n                case 'blog-posts':\n                    // Load blog dashboard stats\n                    this.loadBlogStats();\n                    break;\n                case 'blog-all-posts':\n                    window.blogManager.loadBlogPosts();\n                    break;\n                case 'blog-categories':\n                    window.blogManager.loadCategories();\n                    break;\n                case 'blog-add-new':\n                    // Initialize rich text editor if not already done\n                    if (!window.blogManager.quillEditor) {\n                        setTimeout(() => {\n                            window.blogManager.initializeQuillEditor();\n                            window.blogManager.setupSEOForm();\n                        }, 100);\n                    }\n                    break;\n            }\n        }\n    }\n\n    async loadBlogManager() {\n        try {\n            // Load the blog manager script\n            const script = document.createElement('script');\n            script.src = './cms/blog.js';\n            script.type = 'module';\n            \n            return new Promise((resolve, reject) => {\n                script.onload = () => {\n                    console.log('Blog manager loaded successfully');\n                    resolve();\n                };\n                script.onerror = () => {\n                    console.error('Failed to load blog manager');\n                    reject();\n                };\n                document.head.appendChild(script);\n            });\n        } catch (error) {\n            console.error('Error loading blog manager:', error);\n        }\n    }\n\n    async loadBlogStats() {\n        try {\n            const response = await fetch(`${this.apiBase}/cms/blog/stats`, {\n                headers: { 'Authorization': `Bearer ${this.token}` }\n            });\n\n            const result = await response.json();\n\n            if (result.success) {\n                // Update blog stats in the dashboard\n                const totalPosts = document.getElementById('total-posts');\n                const publishedPosts = document.getElementById('published-posts');\n                const draftPosts = document.getElementById('draft-posts');\n\n                if (totalPosts) totalPosts.textContent = result.data.totalPosts || 0;\n                if (publishedPosts) publishedPosts.textContent = result.data.publishedPosts || 0;\n                if (draftPosts) draftPosts.textContent = result.data.draftPosts || 0;\n            }\n        } catch (error) {\n            console.error('Error loading blog stats:', error);\n        }\n    }\n\n    viewEstimate(id) {\n        alert(`View estimate details for ID: ${id}`);\n    }\n\n    viewArea(id) {\n        alert(`View area details for estimate ID: ${id}`);\n    }\n\n    logout() {\n        localStorage.removeItem('admin_token');\n        this.token = null;\n        this.showLogin();\n    }\n}\n\n// Initialize admin dashboard\nconst adminDashboard = new AdminDashboard();"],"names":["constructor","this","apiBase","window","location","hostname","protocol","token","localStorage","getItem","currentSection","init","verifyToken","showDashboard","error","console","showLogin","response","fetch","headers","Authorization","ok","Error","json","document","getElementById","style","display","loginForm","addEventListener","e","handleLogin","setupEventListeners","showSection","loadDashboardData","preventDefault","formData","FormData","target","credentials","username","get","password","method","body","JSON","stringify","result","success","setItem","alert","message","querySelectorAll","forEach","link","section","getAttribute","closest","sectionName","classList","remove","targetSection","add","activeNavLink","querySelector","loadEstimates","loadJobs","loadCustomers","loadMaps","loadBlogSection","statsResponse","activitiesResponse","Promise","all","stats","activities","textContent","data","pendingEstimates","activeProjects","revenue","toLocaleString","totalProjects","renderActivities","container","length","innerHTML","map","activity","status","type","Date","timestamp","toLocaleDateString","join","renderEstimates","estimates","tbody","estimate","firstName","lastName","email","serviceType","projectAddress","projectSize","id","areaData","log","blogManager","loadBlogManager","loadBlogStats","loadBlogPosts","loadCategories","quillEditor","setTimeout","initializeQuillEditor","setupSEOForm","script","createElement","src","resolve","reject","onload","onerror","head","appendChild","totalPosts","publishedPosts","draftPosts","viewEstimate","viewArea","logout","removeItem"],"mappings":"oCAqWuB,IArWvB,MACI,WAAAA,GAEIC,KAAKC,QAAuC,cAA7BC,OAAOC,SAASC,SACzB,4BACA,GAAGF,OAAOC,SAASE,aAAaH,OAAOC,SAASC,eACtDJ,KAAKM,MAAQC,aAAaC,QAAQ,eAClCR,KAAKS,eAAiB,YAEtBT,KAAKU,MACb,CAEI,UAAMA,GACF,GAAKV,KAAKM,MAKV,UACUN,KAAKW,cACXX,KAAKY,eACjB,OAAiBC,GACLC,QAAQD,MAAM,yBAA0BA,GACxCb,KAAKe,WACjB,MAVYf,KAAKe,WAWjB,CAEI,iBAAMJ,GACF,MAAMK,QAAiBC,MAAM,GAAGjB,KAAKC,sBAAuB,CACxDiB,QAAS,CACLC,cAAiB,UAAUnB,KAAKM,WAIxC,IAAKU,EAASI,GACV,MAAM,IAAIC,MAAM,6BAGpB,OAAOL,EAASM,MACxB,CAEI,SAAAP,GACIQ,SAASC,eAAe,gBAAgBC,MAAMC,QAAU,QACxDH,SAASC,eAAe,mBAAmBC,MAAMC,QAAU,OAE3D,MAAMC,EAAYJ,SAASC,eAAe,cACtCG,GACAA,EAAUC,iBAAiB,SAAWC,GAAM7B,KAAK8B,YAAYD,GAEzE,CAEI,aAAAjB,GACIW,SAASC,eAAe,gBAAgBC,MAAMC,QAAU,OACxDH,SAASC,eAAe,mBAAmBC,MAAMC,QAAU,QAE3D1B,KAAK+B,sBACL/B,KAAKgC,YAAY,aACjBhC,KAAKiC,mBACb,CAEI,iBAAMH,CAAYD,GACdA,EAAEK,iBAEF,MAAMC,EAAW,IAAIC,SAASP,EAAEQ,QAC1BC,EAAc,CAChBC,SAAUJ,EAASK,IAAI,YACvBC,SAAUN,EAASK,IAAI,aAG3B,IACI,MAAMxB,QAAiBC,MAAM,GAAGjB,KAAKC,qBAAsB,CACvDyC,OAAQ,OACRxB,QAAS,CACL,eAAgB,oBAEpByB,KAAMC,KAAKC,UAAUP,KAGnBQ,QAAe9B,EAASM,OAE1BwB,EAAOC,SACPxC,aAAayC,QAAQ,cAAeF,EAAOxC,OAC3CN,KAAKM,MAAQwC,EAAOxC,MACpBN,KAAKY,iBAELqC,MAAM,iBAAmBH,EAAOI,QAEhD,OAAiBrC,GACLC,QAAQD,MAAM,eAAgBA,GAC9BoC,MAAM,kCAClB,CACA,CAEI,mBAAAlB,GAEIR,SAAS4B,iBAAiB,kBAAkBC,QAAQC,IAChDA,EAAKzB,iBAAiB,QAAUC,IAC5BA,EAAEK,iBACF,MAAMoB,EAAUzB,EAAEQ,OAAOkB,aAAa,iBAAmB1B,EAAEQ,OAAOmB,QAAQ,kBAAkBD,aAAa,gBACzGvD,KAAKgC,YAAYsB,MAGjC,CAEI,WAAAtB,CAAYyB,GAERlC,SAAS4B,iBAAiB,oBAAoBC,QAAQE,IAClDA,EAAQI,UAAUC,OAAO,YAI7B,MAAMC,EAAgBrC,SAASC,eAAe,GAAGiC,aAC7CG,GACAA,EAAcF,UAAUG,IAAI,UAIhCtC,SAAS4B,iBAAiB,sBAAsBC,QAAQC,IACpDA,EAAKK,UAAUC,OAAO,YAG1B,MAAMG,EAAgBvC,SAASwC,cAAc,kBAAkBN,OAQ/D,OAPIK,GACAA,EAAcJ,UAAUG,IAAI,UAGhC7D,KAAKS,eAAiBgD,EAGfA,GACH,IAAK,YACDzD,KAAKiC,oBACL,MACJ,IAAK,YACDjC,KAAKgE,gBACL,MACJ,IAAK,OACDhE,KAAKiE,WACL,MACJ,IAAK,YACDjE,KAAKkE,gBACL,MACJ,IAAK,OACDlE,KAAKmE,WACL,MACJ,IAAK,aACL,IAAK,iBACL,IAAK,eACL,IAAK,kBACDnE,KAAKoE,gBAAgBX,GAGrC,CAEI,uBAAMxB,GACF,IACI,MAAOoC,EAAeC,SAA4BC,QAAQC,IAAI,CAC1DvD,MAAM,GAAGjB,KAAKC,gCAAiC,CAC3CiB,QAAS,CAAEC,cAAiB,UAAUnB,KAAKM,WAE/CW,MAAM,GAAGjB,KAAKC,qCAAsC,CAChDiB,QAAS,CAAEC,cAAiB,UAAUnB,KAAKM,aAI7CmE,QAAcJ,EAAc/C,OAC5BoD,QAAmBJ,EAAmBhD,OAExCmD,EAAM1B,UACNxB,SAASC,eAAe,qBAAqBmD,YAAcF,EAAMG,KAAKC,iBACtEtD,SAASC,eAAe,eAAemD,YAAcF,EAAMG,KAAKE,eAChEvD,SAASC,eAAe,iBAAiBmD,YAAc,IAAIF,EAAMG,KAAKG,QAAQC,mBAC9EzD,SAASC,eAAe,kBAAkBmD,YAAcF,EAAMG,KAAKK,eAGnEP,EAAW3B,SACX/C,KAAKkF,iBAAiBR,EAAWE,KAEjD,OAAiB/D,GACLC,QAAQD,MAAM,gCAAiCA,EAC3D,CACA,CAEI,gBAAAqE,CAAiBR,GACb,MAAMS,EAAY5D,SAASC,eAAe,qBAEhB,IAAtBkD,EAAWU,OAKfD,EAAUE,UAAYX,EAAWY,IAAIC,GAAY,sIAEiB,cAApBA,EAASC,OAAyB,UAAY,yCAC5D,qBAAlBD,EAASE,KAA8B,KAAO,yHAGrBF,EAASrC,gEACR,IAAIwC,KAAKH,EAASI,WAAWC,+FAEjB,cAApBL,EAASC,OAAyB,UAAY,cAAcD,EAASC,+CAElGK,KAAK,IAfJV,EAAUE,UAAY,gDAgBlC,CAEI,mBAAMrB,GACF,IACI,MAAMhD,QAAiBC,MAAM,GAAGjB,KAAKC,oBAAqB,CACtDiB,QAAS,CAAEC,cAAiB,UAAUnB,KAAKM,WAGzCwC,QAAe9B,EAASM,OAE1BwB,EAAOC,SACP/C,KAAK8F,gBAAgBhD,EAAO8B,KAE5C,OAAiB/D,GACLC,QAAQD,MAAM,2BAA4BA,GAC1CU,SAASC,eAAe,mBAAmB6D,UAAY,sFACnE,CACA,CAEI,eAAAS,CAAgBC,GACZ,MAAMC,EAAQzE,SAASC,eAAe,mBAEb,IAArBuE,EAAUX,OAKdY,EAAMX,UAAYU,EAAUT,IAAIW,GAAY,0FAGLA,EAASC,aAAaD,EAASE,iEAC9BF,EAASG,4FAEJH,EAASI,uDACjCJ,EAASK,gBAAkB,2CAClCL,EAASM,aAAe,yDACkB,YAApBN,EAAST,OAAuB,UAAY,cAAcS,EAAST,sJAEJS,EAASO,4CAC9FP,EAASQ,SAAW,sFAAsFR,EAASO,sBAAwB,0DAGtJX,KAAK,IAnBJG,EAAMX,UAAY,iFAoB9B,CAEI,cAAMpB,GAEFnD,QAAQ4F,IAAI,kBACpB,CAEI,mBAAMxC,GAEFpD,QAAQ4F,IAAI,uBACpB,CAEI,QAAAvC,GAEIrD,QAAQ4F,IAAI,kBACpB,CAEI,qBAAMtC,CAAgBX,GAOlB,GALKvD,OAAOyG,mBACF3G,KAAK4G,kBAIX1G,OAAOyG,YACP,OAAOlD,GACH,IAAK,aAEDzD,KAAK6G,gBACL,MACJ,IAAK,iBACD3G,OAAOyG,YAAYG,gBACnB,MACJ,IAAK,kBACD5G,OAAOyG,YAAYI,iBACnB,MACJ,IAAK,eAEI7G,OAAOyG,YAAYK,aACpBC,WAAW,KACP/G,OAAOyG,YAAYO,wBACnBhH,OAAOyG,YAAYQ,gBACpB,KAK3B,CAEI,qBAAMP,GACF,IAEI,MAAMQ,EAAS7F,SAAS8F,cAAc,UAItC,OAHAD,EAAOE,IAAM,gBACbF,EAAO3B,KAAO,SAEP,IAAIlB,QAAQ,CAACgD,EAASC,KACzBJ,EAAOK,OAAS,KACZ3G,QAAQ4F,IAAI,oCACZa,KAEJH,EAAOM,QAAU,KACb5G,QAAQD,MAAM,+BACd2G,KAEJjG,SAASoG,KAAKC,YAAYR,IAE1C,OAAiBvG,GACLC,QAAQD,MAAM,8BAA+BA,EACzD,CACA,CAEI,mBAAMgG,GACF,IACI,MAAM7F,QAAiBC,MAAM,GAAGjB,KAAKC,yBAA0B,CAC3DiB,QAAS,CAAEC,cAAiB,UAAUnB,KAAKM,WAGzCwC,QAAe9B,EAASM,OAE9B,GAAIwB,EAAOC,QAAS,CAEhB,MAAM8E,EAAatG,SAASC,eAAe,eACrCsG,EAAiBvG,SAASC,eAAe,mBACzCuG,EAAaxG,SAASC,eAAe,eAEvCqG,IAAYA,EAAWlD,YAAc7B,EAAO8B,KAAKiD,YAAc,GAC/DC,IAAgBA,EAAenD,YAAc7B,EAAO8B,KAAKkD,gBAAkB,GAC3EC,IAAYA,EAAWpD,YAAc7B,EAAO8B,KAAKmD,YAAc,EACnF,CACA,OAAiBlH,GACLC,QAAQD,MAAM,4BAA6BA,EACvD,CACA,CAEI,YAAAmH,CAAaxB,GACTvD,MAAM,iCAAiCuD,IAC/C,CAEI,QAAAyB,CAASzB,GACLvD,MAAM,sCAAsCuD,IACpD,CAEI,MAAA0B,GACI3H,aAAa4H,WAAW,eACxBnI,KAAKM,MAAQ,KACbN,KAAKe,WACb"}