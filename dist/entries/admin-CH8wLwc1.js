import"../chunks/chunk-YP0FEG5d.js";new class{constructor(){this.apiBase="localhost"===window.location.hostname?"http://localhost:8001/api":`${window.location.protocol}//${window.location.hostname}/api`,this.token=localStorage.getItem("admin_token"),this.currentSection="dashboard",this.init()}async init(){if(this.token)try{await this.verifyToken(),this.showDashboard()}catch(t){console.error("Authentication failed:",t),this.showLogin()}else this.showLogin()}async verifyToken(){const t=await fetch(`${this.apiBase}/auth/verify`,{headers:{Authorization:`Bearer ${this.token}`}});if(!t.ok)throw new Error("Token verification failed");return t.json()}showLogin(){document.getElementById("login-screen").style.display="block",document.getElementById("admin-dashboard").style.display="none";const t=document.getElementById("login-form");t&&t.addEventListener("submit",t=>this.handleLogin(t))}showDashboard(){document.getElementById("login-screen").style.display="none",document.getElementById("admin-dashboard").style.display="block",this.setupEventListeners(),this.showSection("dashboard"),this.loadDashboardData()}async handleLogin(t){t.preventDefault();const e=new FormData(t.target),a={username:e.get("username"),password:e.get("password")};try{const t=await fetch(`${this.apiBase}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),e=await t.json();e.success?(localStorage.setItem("admin_token",e.token),this.token=e.token,this.showDashboard()):alert("Login failed: "+e.message)}catch(s){console.error("Login error:",s),alert("Login failed. Please try again.")}}setupEventListeners(){document.querySelectorAll("[data-section]").forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();const e=t.target.getAttribute("data-section")||t.target.closest("[data-section]").getAttribute("data-section");this.showSection(e)})})}showSection(t){document.querySelectorAll(".content-section").forEach(t=>{t.classList.remove("active")});const e=document.getElementById(`${t}-section`);e&&e.classList.add("active"),document.querySelectorAll(".sidebar .nav-link").forEach(t=>{t.classList.remove("active")});const a=document.querySelector(`[data-section="${t}"]`);switch(a&&a.classList.add("active"),this.currentSection=t,t){case"dashboard":this.loadDashboardData();break;case"estimates":this.loadEstimates();break;case"jobs":this.loadJobs();break;case"customers":this.loadCustomers();break;case"maps":this.loadMaps();break;case"blog-posts":case"blog-all-posts":case"blog-add-new":case"blog-categories":this.loadBlogSection(t)}}async loadDashboardData(){try{const[t,e]=await Promise.all([fetch(`${this.apiBase}/admin/dashboard/stats`,{headers:{Authorization:`Bearer ${this.token}`}}),fetch(`${this.apiBase}/admin/dashboard/activities`,{headers:{Authorization:`Bearer ${this.token}`}})]),a=await t.json(),s=await e.json();a.success&&(document.getElementById("pending-estimates").textContent=a.data.pendingEstimates,document.getElementById("active-jobs").textContent=a.data.activeProjects,document.getElementById("total-revenue").textContent=`$${a.data.revenue.toLocaleString()}`,document.getElementById("total-projects").textContent=a.data.totalProjects),s.success&&this.renderActivities(s.data)}catch(t){console.error("Error loading dashboard data:",t)}}renderActivities(t){const e=document.getElementById("recent-activities");0!==t.length?e.innerHTML=t.map(t=>`\n            <div class="d-flex align-items-center mb-3 p-3 border rounded">\n                <div class="avatar-initial bg-label-${"completed"===t.status?"success":"warning"} me-3">\n                    ${"estimate_request"===t.type?"üìã":"‚öíÔ∏è"}\n                </div>\n                <div class="flex-grow-1">\n                    <div class="fw-semibold">${t.message}</div>\n                    <small class="text-muted">${new Date(t.timestamp).toLocaleDateString()}</small>\n                </div>\n                <span class="badge bg-${"completed"===t.status?"success":"warning"}">${t.status}</span>\n            </div>\n        `).join(""):e.innerHTML='<p class="text-muted">No recent activities</p>'}async loadEstimates(){try{const t=await fetch(`${this.apiBase}/estimates`,{headers:{Authorization:`Bearer ${this.token}`}}),e=await t.json();e.success&&this.renderEstimates(e.data)}catch(t){console.error("Error loading estimates:",t),document.getElementById("estimates-table").innerHTML='<tr><td colspan="6" class="text-center text-muted">Error loading estimates</td></tr>'}}renderEstimates(t){const e=document.getElementById("estimates-table");0!==t.length?e.innerHTML=t.map(t=>`\n            <tr>\n                <td>\n                    <div class="fw-semibold">${t.firstName} ${t.lastName}</div>\n                    <small class="text-muted">${t.email}</small>\n                </td>\n                <td><span class="badge bg-primary">${t.serviceType}</span></td>\n                <td><small>${t.projectAddress||"N/A"}</small></td>\n                <td>${t.projectSize||"N/A"}</td>\n                <td><span class="badge bg-${"pending"===t.status?"warning":"success"}">${t.status}</span></td>\n                <td>\n                    <button class="btn btn-sm btn-outline-primary" onclick="adminDashboard.viewEstimate('${t.id}')">View</button>\n                    ${t.areaData?`<button class="btn btn-sm btn-outline-info ms-1" onclick="adminDashboard.viewArea('${t.id}')">Area</button>`:""}\n                </td>\n            </tr>\n        `).join(""):e.innerHTML='<tr><td colspan="6" class="text-center text-muted">No estimates found</td></tr>'}async loadJobs(){console.log("Loading jobs...")}async loadCustomers(){console.log("Loading customers...")}loadMaps(){console.log("Loading maps...")}async loadBlogSection(t){if(window.blogManager||await this.loadBlogManager(),window.blogManager)switch(t){case"blog-posts":this.loadBlogStats();break;case"blog-all-posts":window.blogManager.loadBlogPosts();break;case"blog-categories":window.blogManager.loadCategories();break;case"blog-add-new":window.blogManager.quillEditor||setTimeout(()=>{window.blogManager.initializeQuillEditor(),window.blogManager.setupSEOForm()},100)}}async loadBlogManager(){try{const t=document.createElement("script");return t.src="./cms/blog.js",t.type="module",new Promise((e,a)=>{t.onload=()=>{console.log("Blog manager loaded successfully"),e()},t.onerror=()=>{console.error("Failed to load blog manager"),a()},document.head.appendChild(t)})}catch(t){console.error("Error loading blog manager:",t)}}async loadBlogStats(){try{const t=await fetch(`${this.apiBase}/cms/blog/stats`,{headers:{Authorization:`Bearer ${this.token}`}}),e=await t.json();if(e.success){const t=document.getElementById("total-posts"),a=document.getElementById("published-posts"),s=document.getElementById("draft-posts");t&&(t.textContent=e.data.totalPosts||0),a&&(a.textContent=e.data.publishedPosts||0),s&&(s.textContent=e.data.draftPosts||0)}}catch(t){console.error("Error loading blog stats:",t)}}viewEstimate(t){alert(`View estimate details for ID: ${t}`)}viewArea(t){alert(`View area details for estimate ID: ${t}`)}logout(){localStorage.removeItem("admin_token"),this.token=null,this.showLogin()}};
//# sourceMappingURL=admin-CH8wLwc1.js.map
