{"version":3,"file":"admin-BGB2I025.js","sources":["../../admin/admin.js"],"sourcesContent":["class AdminDashboard {\n    constructor() {\n        // Use production URL when deployed to Vercel, localhost for development\n        this.apiBase = window.location.hostname === 'localhost' \n            ? 'http://localhost:8001/api'\n            : `${window.location.protocol}//${window.location.hostname}/api`;\n        this.token = localStorage.getItem('admin_token');\n        this.currentSection = 'dashboard';\n        \n        this.init();\n    }\n\n    async init() {\n        if (!this.token) {\n            this.showLogin();\n            return;\n        }\n\n        try {\n            await this.verifyToken();\n            this.showDashboard();\n        } catch (error) {\n            console.error('Authentication failed:', error);\n            this.showLogin();\n        }\n    }\n\n    async verifyToken() {\n        const response = await fetch(`${this.apiBase}/auth/verify`, {\n            headers: {\n                'Authorization': `Bearer ${this.token}`\n            }\n        });\n\n        if (!response.ok) {\n            throw new Error('Token verification failed');\n        }\n\n        return response.json();\n    }\n\n    showLogin() {\n        document.getElementById('login-screen').style.display = 'block';\n        document.getElementById('admin-dashboard').style.display = 'none';\n        \n        const loginForm = document.getElementById('login-form');\n        if (loginForm) {\n            loginForm.addEventListener('submit', (e) => this.handleLogin(e));\n        }\n    }\n\n    showDashboard() {\n        document.getElementById('login-screen').style.display = 'none';\n        document.getElementById('admin-dashboard').style.display = 'block';\n        \n        this.setupEventListeners();\n        this.showSection('dashboard');\n        this.loadDashboardData();\n    }\n\n    async handleLogin(e) {\n        e.preventDefault();\n        \n        const formData = new FormData(e.target);\n        const credentials = {\n            username: formData.get('username'),\n            password: formData.get('password')\n        };\n\n        try {\n            const response = await fetch(`${this.apiBase}/auth/login`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(credentials)\n            });\n\n            const result = await response.json();\n\n            if (result.success) {\n                localStorage.setItem('admin_token', result.token);\n                this.token = result.token;\n                this.showDashboard();\n            } else {\n                alert('Login failed: ' + result.message);\n            }\n        } catch (error) {\n            console.error('Login error:', error);\n            alert('Login failed. Please try again.');\n        }\n    }\n\n    setupEventListeners() {\n        // Menu navigation\n        document.querySelectorAll('[data-section]').forEach(link => {\n            link.addEventListener('click', (e) => {\n                e.preventDefault();\n                const section = e.target.getAttribute('data-section') || e.target.closest('[data-section]').getAttribute('data-section');\n                this.showSection(section);\n            });\n        });\n    }\n\n    showSection(sectionName) {\n        // Hide all sections\n        document.querySelectorAll('.content-section').forEach(section => {\n            section.classList.remove('active');\n        });\n\n        // Show selected section\n        const targetSection = document.getElementById(`${sectionName}-section`);\n        if (targetSection) {\n            targetSection.classList.add('active');\n        }\n\n        // Update active nav item\n        document.querySelectorAll('.sidebar .nav-link').forEach(link => {\n            link.classList.remove('active');\n        });\n        \n        const activeNavLink = document.querySelector(`[data-section=\"${sectionName}\"]`);\n        if (activeNavLink) {\n            activeNavLink.classList.add('active');\n        }\n\n        this.currentSection = sectionName;\n\n        // Load section data\n        switch(sectionName) {\n            case 'dashboard':\n                this.loadDashboardData();\n                break;\n            case 'estimates':\n                this.loadEstimates();\n                break;\n            case 'jobs':\n                this.loadJobs();\n                break;\n            case 'customers':\n                this.loadCustomers();\n                break;\n            case 'maps':\n                this.loadMaps();\n                break;\n        }\n    }\n\n    async loadDashboardData() {\n        try {\n            const [statsResponse, activitiesResponse] = await Promise.all([\n                fetch(`${this.apiBase}/admin/dashboard/stats`, {\n                    headers: { 'Authorization': `Bearer ${this.token}` }\n                }),\n                fetch(`${this.apiBase}/admin/dashboard/activities`, {\n                    headers: { 'Authorization': `Bearer ${this.token}` }\n                })\n            ]);\n\n            const stats = await statsResponse.json();\n            const activities = await activitiesResponse.json();\n\n            if (stats.success) {\n                document.getElementById('pending-estimates').textContent = stats.data.pendingEstimates;\n                document.getElementById('active-jobs').textContent = stats.data.activeProjects;\n                document.getElementById('total-revenue').textContent = `$${stats.data.revenue.toLocaleString()}`;\n                document.getElementById('total-projects').textContent = stats.data.totalProjects;\n            }\n\n            if (activities.success) {\n                this.renderActivities(activities.data);\n            }\n        } catch (error) {\n            console.error('Error loading dashboard data:', error);\n        }\n    }\n\n    renderActivities(activities) {\n        const container = document.getElementById('recent-activities');\n        \n        if (activities.length === 0) {\n            container.innerHTML = '<p class=\"text-muted\">No recent activities</p>';\n            return;\n        }\n\n        container.innerHTML = activities.map(activity => `\n            <div class=\"d-flex align-items-center mb-3 p-3 border rounded\">\n                <div class=\"avatar-initial bg-label-${activity.status === 'completed' ? 'success' : 'warning'} me-3\">\n                    ${activity.type === 'estimate_request' ? 'üìã' : '‚öíÔ∏è'}\n                </div>\n                <div class=\"flex-grow-1\">\n                    <div class=\"fw-semibold\">${activity.message}</div>\n                    <small class=\"text-muted\">${new Date(activity.timestamp).toLocaleDateString()}</small>\n                </div>\n                <span class=\"badge bg-${activity.status === 'completed' ? 'success' : 'warning'}\">${activity.status}</span>\n            </div>\n        `).join('');\n    }\n\n    async loadEstimates() {\n        try {\n            const response = await fetch(`${this.apiBase}/estimates`, {\n                headers: { 'Authorization': `Bearer ${this.token}` }\n            });\n\n            const result = await response.json();\n            \n            if (result.success) {\n                this.renderEstimates(result.data);\n            }\n        } catch (error) {\n            console.error('Error loading estimates:', error);\n            document.getElementById('estimates-table').innerHTML = '<tr><td colspan=\"6\" class=\"text-center text-muted\">Error loading estimates</td></tr>';\n        }\n    }\n\n    renderEstimates(estimates) {\n        const tbody = document.getElementById('estimates-table');\n        \n        if (estimates.length === 0) {\n            tbody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center text-muted\">No estimates found</td></tr>';\n            return;\n        }\n\n        tbody.innerHTML = estimates.map(estimate => `\n            <tr>\n                <td>\n                    <div class=\"fw-semibold\">${estimate.firstName} ${estimate.lastName}</div>\n                    <small class=\"text-muted\">${estimate.email}</small>\n                </td>\n                <td><span class=\"badge bg-primary\">${estimate.serviceType}</span></td>\n                <td><small>${estimate.projectAddress || 'N/A'}</small></td>\n                <td>${estimate.projectSize || 'N/A'}</td>\n                <td><span class=\"badge bg-${estimate.status === 'pending' ? 'warning' : 'success'}\">${estimate.status}</span></td>\n                <td>\n                    <button class=\"btn btn-sm btn-outline-primary\" onclick=\"adminDashboard.viewEstimate('${estimate.id}')\">View</button>\n                    ${estimate.areaData ? `<button class=\"btn btn-sm btn-outline-info ms-1\" onclick=\"adminDashboard.viewArea('${estimate.id}')\">Area</button>` : ''}\n                </td>\n            </tr>\n        `).join('');\n    }\n\n    async loadJobs() {\n        // Placeholder for jobs functionality\n        console.log('Loading jobs...');\n    }\n\n    async loadCustomers() {\n        // Placeholder for customers functionality\n        console.log('Loading customers...');\n    }\n\n    loadMaps() {\n        // Placeholder for maps functionality\n        console.log('Loading maps...');\n    }\n\n    viewEstimate(id) {\n        alert(`View estimate details for ID: ${id}`);\n    }\n\n    viewArea(id) {\n        alert(`View area details for estimate ID: ${id}`);\n    }\n\n    logout() {\n        localStorage.removeItem('admin_token');\n        this.token = null;\n        this.showLogin();\n    }\n}\n\n// Initialize admin dashboard\nconst adminDashboard = new AdminDashboard();"],"names":[],"mappings":"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"}