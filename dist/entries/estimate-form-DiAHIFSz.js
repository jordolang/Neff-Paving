import"../chunks/chunk-YP0FEG5d.js";/* empty css                      */class e{constructor(){this.measurementData=null,this.boundaryData=null,this.isInitialized=!1,this.currentMeasurement=null,this.currentBoundary=null,this.boundaryPreview=null,this.isEditMode=!1,this.drawingMetadata=null,this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setupBindings()):this.setupBindings()}setupBindings(){this.setupIframeMessageListener(),this.setupFormButtons(),this.updateSubmitButtonState(),console.log("Map-to-form binding initialized")}setupIframeMessageListener(){window.addEventListener("message",e=>{if(e.origin!==window.location.origin)return;const{type:t,data:a}=e.data;switch(t){case"MEASUREMENT_COMPLETE":this.handleMeasurementComplete(a);break;case"MEASUREMENT_CLEARED":this.handleMeasurementCleared();break;case"MEASUREMENT_ERROR":this.handleMeasurementError(a);break;case"BOUNDARY_COMPLETE":this.handleBoundaryComplete(a);break;case"BOUNDARY_EDIT_START":this.handleBoundaryEditStart(a);break;case"BOUNDARY_EDIT_UPDATE":this.handleBoundaryEditUpdate(a);break;case"BOUNDARY_EDIT_COMPLETE":this.handleBoundaryEditComplete(a);break;case"BOUNDARY_PREVIEW":this.handleBoundaryPreview(a);break;case"BOUNDARY_CLEARED":this.handleBoundaryCleared();break;case"DRAWING_METADATA":this.handleDrawingMetadata(a)}})}setupFormButtons(){const e=document.getElementById("clear-measurement"),t=document.getElementById("confirm-measurement"),a=document.getElementById("clear-boundary"),n=document.getElementById("confirm-boundary");e&&e.addEventListener("click",()=>this.clearMeasurement()),t&&t.addEventListener("click",()=>this.confirmMeasurement()),a&&a.addEventListener("click",()=>this.clearBoundary()),n&&n.addEventListener("click",()=>this.confirmBoundary())}handleBoundaryComplete(e){console.log("Boundary completed:",e);const t=this.calculatePerimeter(e.geometry);if(!this.validateBoundary(e.geometry))return console.error("Invalid boundary data"),void this.updateMeasurementStatus("Invalid boundary: minimum 3 vertices required and polygon must be closed","error");this.boundaryData={...e,perimeter:t,vertexCount:e.geometry.rings[0].length-1,timestamp:(new Date).toISOString()},this.updateBoundaryDisplay(),this.populateBoundaryFields(),this.updateSubmitButtonState()}calculatePerimeter(e){if(!e||!e.rings)return 0;const t=e.rings[0];let a=0;for(let n=0;n<t.length-1;n++){const[e,r]=t[n],[s,o]=t[n+1];a+=Math.sqrt(Math.pow(s-e,2)+Math.pow(o-r,2))}if(!this.isClosedPolygon(t)){const[e,n]=t[0],[r,s]=t[t.length-1];a+=Math.sqrt(Math.pow(r-e,2)+Math.pow(s-n,2))}return a}validateBoundary(e){if(!e||!e.rings)return!1;const t=e.rings[0];return t.length>=4&&this.isClosedPolygon(t)}isClosedPolygon(e){const t=e[0],a=e[e.length-1];return t[0]===a[0]&&t[1]===a[1]}handleBoundaryEditStart(e){console.log("Boundary editing started:",e),this.isEditMode=!0,this.updateMeasurementStatus("Boundary editing mode active","info")}handleBoundaryEditUpdate(e){console.log("Boundary editing updated:",e),this.boundaryPreview=e,this.updateBoundaryPreview()}handleBoundaryEditComplete(e){console.log("Boundary editing completed:",e),this.isEditMode=!1,this.handleBoundaryComplete(e)}handleBoundaryPreview(e){console.log("Boundary preview:",e),this.boundaryPreview=e,this.updateBoundaryPreview()}handleDrawingMetadata(e){console.log("Drawing metadata:",e),this.drawingMetadata={...e,timestamp:(new Date).toISOString()}}updateBoundaryDisplay(){if(!this.boundaryData)return;const e=document.getElementById("boundary-status");e&&(e.innerHTML='\n                <div class="boundary-success">\n                    <span class="status-indicator">✅</span>\n                    <span class="status-text">Boundary drawn successfully</span>\n                </div>\n            ');const t=document.getElementById("boundary-perimeter-display");t&&(t.textContent=`${this.boundaryData.perimeter.toLocaleString()} units`);const a=document.getElementById("boundary-vertices-display");a&&(a.textContent=`${this.boundaryData.vertexCount} vertices`)}updateBoundaryPreview(){if(!this.boundaryPreview)return;const e=document.getElementById("boundary-preview");if(e){const t=this.calculatePerimeter(this.boundaryPreview.geometry),a=this.boundaryPreview.geometry.rings[0].length-1;e.innerHTML=`\n                <div class="boundary-preview">\n                    <span class="preview-text">Preview: ${a} vertices, ${t.toLocaleString()} units perimeter</span>\n                </div>\n            `}}populateBoundaryFields(){if(!this.boundaryData)return;const e=document.getElementById("boundary-coordinates");e&&(e.value=JSON.stringify(this.boundaryData.geometry));const t=document.getElementById("boundary-perimeter");t&&(t.value=this.boundaryData.perimeter.toString());const a=document.getElementById("boundary-vertex-count");a&&(a.value=this.boundaryData.vertexCount.toString());const n=document.getElementById("drawing-metadata");n&&this.drawingMetadata&&(n.value=JSON.stringify(this.drawingMetadata));const r=document.getElementById("boundary-timestamp");r&&(r.value=this.boundaryData.timestamp)}handleBoundaryCleared(){console.log("Boundary cleared"),this.boundaryData=null,this.boundaryPreview=null,this.isEditMode=!1;["boundary-coordinates","boundary-perimeter","boundary-vertex-count","drawing-metadata","boundary-timestamp"].forEach(e=>{const t=document.getElementById(e);t&&(t.value="")});const e=document.getElementById("boundary-status");e&&(e.innerHTML="");const t=document.getElementById("boundary-preview");t&&(t.innerHTML="")}clearBoundary(){const e=document.getElementById("arcgis-measurement-iframe");e&&e.contentWindow&&e.contentWindow.postMessage({type:"CLEAR_BOUNDARY"},window.location.origin),this.handleBoundaryCleared()}confirmBoundary(){if(!this.boundaryData)return void alert("No boundary data to confirm");this.updateMeasurementStatus(`Confirmed boundary: ${this.boundaryData.vertexCount} vertices, ${this.boundaryData.perimeter.toLocaleString()} units perimeter`,"success");const e=document.querySelector(".boundary-container");e&&e.classList.add("boundary-confirmed")}handleMeasurementComplete(e){console.log("Measurement completed:",e),this.currentMeasurement=e;const t=e.area||0,a=e.unit||"square-meters",n=e.geometry||null,r=this.convertToSquareFeet(t,a);this.measurementData={area:r,originalArea:t,originalUnit:a,coordinates:n,timestamp:(new Date).toISOString()},this.updateMeasurementDisplay(r),this.populateHiddenFields(),this.updateSubmitButtonState(),this.showMeasurementResults()}handleMeasurementCleared(){console.log("Measurement cleared"),this.currentMeasurement=null,this.measurementData=null,this.clearHiddenFields(),this.hideMeasurementResults(),this.updateMeasurementStatus("Please measure your project area to proceed"),this.updateSubmitButtonState()}handleMeasurementError(e){console.error("Measurement error:",e),this.updateMeasurementStatus(`Error: ${e.message||"Measurement failed"}`,"error")}convertToSquareFeet(e,t){const a={"square-meters":10.7639,"square-feet":1,acres:43560,sqm:10.7639,sqft:1,"m²":10.7639,"ft²":1};return e*(a[t]||a["square-meters"])}updateMeasurementDisplay(e){const t=document.getElementById("measurement-status");t&&(t.innerHTML='\n                <div class="measurement-success">\n                    <span class="status-indicator">✅</span>\n                    <span class="status-text">Area measured successfully</span>\n                </div>\n            ');const a=document.getElementById("measured-area");a&&(a.textContent=`${e.toLocaleString()} sq ft`);const n=document.getElementById("measured-coordinates");if(n&&this.measurementData.coordinates){const e=this.formatCoordinates(this.measurementData.coordinates);n.textContent=e}}formatCoordinates(e){var t;if(!e||!e.rings)return"Coordinates available";return`${(null==(t=e.rings[0])?void 0:t.length)||0} coordinate points`}populateHiddenFields(){if(!this.measurementData)return;const e=document.getElementById("area-coordinates");e&&(e.value=JSON.stringify(this.measurementData.coordinates));const t=document.getElementById("square-footage");t&&(t.value=this.measurementData.area.toString());const a=document.getElementById("calculatedSquareFootage");a&&(a.value=this.measurementData.area.toString());const n=document.getElementById("measurementTimestamp");n&&(n.value=this.measurementData.timestamp);const r=document.getElementById("measurementTool");r&&(r.value="arcgis-3d")}clearHiddenFields(){["area-coordinates","square-footage","calculatedSquareFootage","measurementTimestamp","measurementTool","boundary-coordinates","boundary-perimeter","boundary-vertex-count","drawing-metadata","boundary-timestamp"].forEach(e=>{const t=document.getElementById(e);t&&(t.value="")})}showMeasurementResults(){const e=document.getElementById("measurement-results");e&&(e.style.display="block")}hideMeasurementResults(){const e=document.getElementById("measurement-results");e&&(e.style.display="none")}updateMeasurementStatus(e,t="info"){const a=document.getElementById("measurement-status");if(!a)return;a.innerHTML=`\n            <span class="status-indicator">${{info:"⚠️",success:"✅",error:"❌"}[t]}</span>\n            <span class="status-text">${e}</span>\n        `}updateSubmitButtonState(){const e=document.getElementById("submit-button")||document.getElementById("submit-estimate");if(!e)return;const t=this.measurementData&&this.measurementData.area>0,a=this.checkRequiredFields();if(e.disabled=!t||!a,t){const t=e.querySelector(".btn-text")||e;t.textContent.includes("area")&&(t.textContent="Submit Estimate")}}checkRequiredFields(){return["firstName","lastName","email","phone","serviceType","streetAddress","city","state","zipCode"].every(e=>{const t=document.getElementById(e)||document.querySelector(`[name="${e}"]`);return t&&t.value.trim()})}clearMeasurement(){const e=document.getElementById("arcgis-measurement-iframe");e&&e.contentWindow&&e.contentWindow.postMessage({type:"CLEAR_MEASUREMENT"},window.location.origin),this.handleMeasurementCleared()}confirmMeasurement(){if(!this.measurementData)return void alert("No measurement data to confirm");this.updateMeasurementStatus(`Confirmed: ${this.measurementData.area.toLocaleString()} sq ft`,"success");const e=document.querySelector(".measurement-container");e&&e.classList.add("measurement-confirmed")}getMeasurementData(){return this.measurementData}getBoundaryData(){return this.boundaryData}getBoundaryPreview(){return this.boundaryPreview}getDrawingMetadata(){return this.drawingMetadata}hasMeasurement(){return this.measurementData&&this.measurementData.area>0}hasBoundary(){return this.boundaryData&&this.boundaryData.geometry&&this.validateBoundary(this.boundaryData.geometry)}isInEditMode(){return this.isEditMode}processVertexCoordinates(e){if(!e||!e.rings)return[];return e.rings[0].map((e,t)=>({index:t,x:e[0],y:e[1],z:e[2]||0}))}convertPerimeter(e,t,a){const n={meters:1,feet:3.28084,yards:1.09361,miles:621371e-9};return e/(n[t]||1)*(n[a]||1)}}const t=new e;window.MapFormBinding=e,window.mapFormBinding=t;
//# sourceMappingURL=estimate-form-DiAHIFSz.js.map
