<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Cache Control Meta Tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Permissions Policy Meta Tag -->
    <meta http-equiv="Permissions-Policy" content="geolocation=(self)">

    <!-- Primary Meta Tags -->
    <title>Neff Paving - Professional Estimate Calculator</title>
    <meta name="title" content="Neff Paving - Professional Estimate Calculator">
    <meta name="description" content="Get an instant, accurate paving estimate with our advanced calculator. Draw your project area on the map and get transparent pricing for asphalt, concrete, and paver installations.">
    <meta name="keywords" content="paving estimate, asphalt estimate, concrete estimate, paving calculator, driveway estimate, parking lot estimate">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Neff Paving">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://neffpaving.com/estimate-form.html">
    <meta property="og:title" content="Get Your Free Paving Estimate - Neff Paving Calculator">
    <meta property="og:description" content="Get an instant, accurate paving estimate with our advanced calculator. Draw your project area on the map and get transparent pricing for asphalt, concrete, and paver installations.">
    <meta property="og:image" content="assets/estimator.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Neff Paving">
    <meta property="og:locale" content="en_US">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://neffpaving.com/estimate-form.html">
    <meta property="twitter:title" content="Get Your Free Paving Estimate - Neff Paving Calculator">
    <meta property="twitter:description" content="Get an instant, accurate paving estimate with our advanced calculator. Draw your project area and get transparent pricing.">
    <meta property="twitter:image" content="assets/estimator.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://neffpaving.com/estimate-form.html">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <link rel="stylesheet" href="styles/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
         :root {
            --asphalt-dark: #2C2C2C;
            --safety-yellow: #FFD700;
            --pure-white: #FFFFFF;
            --error-red: #e74c3c;
            --success-green: #27ae60;
            --light-gray: #f8f9fa;
            --concrete: #ecf0f1;
            --road-gray: #7f8c8d;
            --font-primary: 'Oswald', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --transition: all 0.3s ease;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-primary);
            background: var(--asphalt-dark);
            min-height: 100vh;
            padding: 20px;
        }
        
        nav a.active {
            color: var(--safety-yellow) !important;
        }
        
        nav a.active::after {
            width: 100%;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--pure-white);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }
        
        .header {
            background: var(--asphalt-dark);
            color: var(--pure-white);
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-family: var(--font-primary);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--safety-yellow);
        }
        
        .header h2 {
            font-family: var(--font-primary);
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: 400;
            color: var(--pure-white);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
            color: var(--pure-white);
        }
        
        .header-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .badge {
            background: rgba(255, 215, 0, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid var(--safety-yellow);
            color: var(--safety-yellow);
        }
        
        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .form-section {
            background: var(--pure-white);
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }
        
        .section-title {
            font-family: var(--font-primary);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--asphalt-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--safety-yellow);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-family: var(--font-primary);
            font-weight: 500;
            color: var(--asphalt-dark);
        }
        
        input,
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--concrete);
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--font-primary);
            transition: var(--transition);
            background: var(--pure-white);
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--safety-yellow);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }
        
        #map {
            height: 400px;
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background-color: #e0e0e0;
            position: relative;
        }
        
        .map-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--font-primary);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: var(--safety-yellow);
            color: var(--asphalt-dark);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }
        
        .btn-secondary {
            background: var(--road-gray);
            color: var(--pure-white);
        }
        
        .btn-danger {
            background: var(--error-red);
            color: var(--pure-white);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary:hover {
            background: #e6c200;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
        }
        
        .area-info {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .area-display {
            font-family: var(--font-primary);
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--asphalt-dark);
            margin-bottom: 10px;
        }
        
        .price-breakdown {
            background: rgba(255, 215, 0, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-family: var(--font-primary);
            font-weight: 500;
            color: var(--asphalt-dark);
        }
        
        .total-price {
            font-family: var(--font-primary);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--safety-yellow);
            border-top: 2px solid var(--safety-yellow);
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .submit-section {
            grid-column: 1 / -1;
            text-align: center;
            margin-top: 20px;
        }
        
        .submit-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            font-family: var(--font-primary);
            font-weight: 700;
            background: var(--safety-yellow);
            color: var(--asphalt-dark);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            background: #e6c200;
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.6);
        }
        
        .submit-btn:disabled {
            background: var(--road-gray);
            color: var(--pure-white);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .info-section {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .info-title {
            font-family: var(--font-primary);
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--asphalt-dark);
            margin-bottom: 10px;
        }
        
        .info-list {
            list-style: none;
            padding: 0;
        }
        
        .info-list li {
            padding: 5px 0;
            color: var(--asphalt-dark);
            font-family: var(--font-primary);
            font-weight: 400;
        }
        
        .info-list li:before {
            content: '‚úì';
            color: var(--safety-yellow);
            margin-right: 10px;
            font-weight: bold;
        }
        
        .contact-info {
            background: var(--asphalt-dark);
            color: var(--pure-white);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }
        
        .contact-info h3 {
            font-family: var(--font-primary);
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--safety-yellow);
        }
        
        .contact-info p {
            margin: 5px 0;
            font-size: 1.1rem;
            font-family: var(--font-primary);
            font-weight: 400;
        }
        
        .contact-info a {
            color: var(--safety-yellow);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .contact-info a:hover {
            color: var(--pure-white);
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .form-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .header h1 {
                font-size: 2rem;
            }
            .header h2 {
                font-size: 1.5rem;
            }
            .map-controls {
                flex-direction: column;
            }
            .header-badges {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="header-container">
            <h1>Neff Paving</h1>
            <nav>
                <ul>
                    <li><a href="index.html#home">Home</a></li>
                    <li><a href="index.html#services">Services</a></li>
                    <li><a href="gallery.html">Gallery</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="estimate-form.html" class="active">Estimates</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                </ul>
            </nav>
            <div class="social-links">
                <a href="https://www.facebook.com/neffpaving" target="_blank" rel="noopener" aria-label="Facebook">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                </a>
                <a href="https://www.yellowpages.com/zanesville-oh/mip/neff-paving-and-concrete-475086775" target="_blank" rel="noopener" aria-label="Yellow Pages">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9l-5 4.87 1.18 6.88L12 17.77l-6.18 2.98L7 14.87 2 10l6.91-1.74L12 2z"/>
                    </svg>
                </a>
                <a href="mailto:sales@neffpaving.com" aria-label="Email">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                </a>
                <a href="https://twitter.com/neffpaving" target="_blank" rel="noopener" aria-label="X (Twitter)">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </a>
            </div>
        </div>
    </header>

    <main style="padding-top: 120px;">
        <div class="container">
            <div class="header">
                <h1>üèóÔ∏è Professional Paving Estimate</h1>
                <h2>Get Your Instant Quote</h2>
                <p>Select your area on the map and get an instant, accurate quote for your paving project</p>
                <div class="header-badges">
                    <span class="badge">‚úì Licensed & Insured</span>
                    <span class="badge">‚úì 28+ Years Experience</span>
                    <span class="badge">‚úì Free Estimates</span>
                </div>
            </div>

            <form id="estimateForm" class="form-container">
                <div class="form-section">
                    <h2 class="section-title">Customer Information</h2>

                    <div class="form-group">
                        <label for="customerName">Full Name *</label>
                        <input type="text" id="customerName" name="customerName" required>
                    </div>

                    <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" name="email" required>
                    </div>

                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>

                    <div class="form-group">
                        <label for="address">Property Address *</label>
                        <input type="text" id="address" name="address" required>
                    </div>

                    <div class="form-group">
                        <label for="projectType">Project Type</label>
                        <select id="projectType" name="projectType">
                        <option value="driveway">Driveway</option>
                        <option value="walkway">Walkway</option>
                        <option value="patio">Patio</option>
                        <option value="parking">Parking Area</option>
                        <option value="other">Other</option>
                    </select>
                    </div>

                    <div class="form-group">
                        <label for="material">Paving Material</label>
                        <select id="material" name="material">
                        <option value="asphalt">Asphalt ($8/sq ft)</option>
                        <option value="concrete">Concrete ($12/sq ft)</option>
                        <option value="brick">Brick Pavers ($15/sq ft)</option>
                        <option value="stone">Natural Stone ($20/sq ft)</option>
                    </select>
                    </div>

                    <div class="info-section">
                        <div class="info-title">What's Included:</div>
                        <ul class="info-list">
                            <li>Site preparation and excavation</li>
                            <li>Base installation and compaction</li>
                            <li>Material supply and installation</li>
                            <li>Cleanup and final grading</li>
                            <li>2-year workmanship warranty</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label for="notes">Additional Notes</label>
                        <textarea id="notes" name="notes" rows="4" placeholder="Any special requirements or notes..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h2 class="section-title">Area Selection</h2>

                    <div id="map"></div>

                    <div class="map-controls">
                        <button type="button" class="btn btn-primary" onclick="startDrawing()">Draw Area</button>
                        <button type="button" class="btn btn-secondary" onclick="clearPolygon()">Clear</button>
                        <button type="button" class="btn btn-danger" onclick="deleteSelected()">Delete Selected</button>
                    </div>

                    <div class="area-info">
                        <div class="area-display">
                            Selected Area: <span id="areaDisplay">0 sq ft</span>
                        </div>

                        <div class="price-breakdown">
                            <div class="price-item">
                                <span>Material Cost:</span>
                                <span id="materialCost">$0.00</span>
                            </div>
                            <div class="price-item">
                                <span>Labor Cost:</span>
                                <span id="laborCost">$0.00</span>
                            </div>
                            <div class="price-item">
                                <span>Equipment Cost:</span>
                                <span id="equipmentCost">$0.00</span>
                            </div>
                            <div class="price-item total-price">
                                <span>Total Estimate:</span>
                                <span id="totalPrice">$0.00</span>
                            </div>
                        </div>

                        <div class="disclaimer">
                            <div class="disclaimer-title">
                                üìã Important Disclaimer
                            </div>
                            <ul>
                                <li>This estimate is preliminary and provided for informational purposes only. Actual costs may vary based on site conditions, material availability, and project specifications.</li>
                                <li>Final pricing will be determined following a comprehensive on-site inspection and detailed project assessment by our licensed professionals.</li>
                                <li>This estimate is valid for 30 days from the date of generation. Pricing is subject to change due to material cost fluctuations and seasonal variations.</li>
                                <li>All work is subject to our standard terms and conditions, which will be provided with the formal written quote.</li>
                                <li>Additional costs may apply for permits, utility markings, unexpected site conditions, or modifications to the original scope of work.</li>
                                <li>Weather conditions, accessibility issues, and municipal requirements may affect the final project timeline and cost.</li>
                            </ul>
                            <div class="important-note">
                                <strong>Note:</strong> By submitting this form, you agree to receive a formal written estimate and acknowledge that this preliminary estimate does not constitute a binding contract. All work requires a signed agreement
                                and proper permits where applicable.
                            </div>
                        </div>

                        <div class="submit-section">
                            <button type="submit" class="submit-btn" id="submitBtn" disabled>
                    üöÄ Get Your Free Estimate
                </button>
                            <p style="margin-top: 15px; color: #7f8c8d; font-size: 0.9rem;">
                                * No obligation ‚Ä¢ Response within 24 hours ‚Ä¢ Licensed professionals
                            </p>
                        </div>

                        <div class="contact-info">
                            <h3>üèóÔ∏è Neff Paving - Your Trusted Partner</h3>
                            <p>üìû Call us directly: <a href="tel:+17404533063">(740) 453-3063</a></p>
                            <p>üìß Email: <a href="mailto:info@neffpaving.com">info@neffpaving.com</a></p>
                            <p>üìç Proudly Serving Southeastern Ohio for nearly30 years!</p>
                        </div>
            </form>
            </div>
    </main>

    <script>
        let map;
        let drawingManager;
        let currentPolygon = null;
        let selectedArea = 0;

        // Material prices per square foot
        const materialPrices = {
            asphalt: 8,
            concrete: 12,
            brick: 15,
            stone: 20
        };

        // Error handling for Google Maps API
        window.gm_authFailure = function() {
            console.error('Google Maps authentication failed!');
            const mapDiv = document.getElementById('map');
            mapDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: #e74c3c;"><h3>Map Loading Error</h3><p>Unable to authenticate with Google Maps. Please check your API key and permissions.</p></div>';
        };

        // Initialize Google Maps
        function initMap() {
            console.log('Initializing Google Maps...');
            
            try {
                // Check if Google Maps API is loaded
                if (typeof google === 'undefined' || !google.maps) {
                    throw new Error('Google Maps API not loaded');
                }

                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 18,
                    center: {
                        lat: 39.94041,
                        lng: -82.00734
                    }, // Default to Muskingum County Courthouse
                    mapTypeId: 'satellite',
                    tilt: 0, // Explicitly set tilt to 0 to avoid 45¬∞ imagery
                    mapTypeControl: true,
                    mapTypeControlOptions: {
                        mapTypeIds: ['roadmap', 'satellite', 'hybrid', 'terrain'],
                        style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                        position: google.maps.ControlPosition.TOP_CENTER
                    }
                });

                console.log('Map initialized successfully');

                drawingManager = new google.maps.drawing.DrawingManager({
                    drawingMode: null,
                    drawingControl: false,
                    polygonOptions: {
                        fillColor: '#FFD700',
                        fillOpacity: 0.3,
                        strokeColor: '#FFD700',
                        strokeOpacity: 0.8,
                        strokeWeight: 2,
                        clickable: true,
                        editable: true
                    }
                });

                drawingManager.setMap(map);
                console.log('Drawing manager initialized');

                // Listen for polygon completion
                drawingManager.addListener('polygoncomplete', function(polygon) {
                    if (currentPolygon) {
                        currentPolygon.setMap(null);
                    }
                    currentPolygon = polygon;
                    calculateArea();
                    drawingManager.setDrawingMode(null);

                    // Add listener for polygon changes
                    polygon.getPath().addListener('set_at', calculateArea);
                    polygon.getPath().addListener('insert_at', calculateArea);
                    polygon.getPath().addListener('remove_at', calculateArea);
                });

            // Try to get user's location with improved error handling
            if (navigator.geolocation) {
                // Check permissions first
                navigator.permissions.query({name: 'geolocation'}).then(function(result) {
                    if (result.state === 'granted') {
                        navigator.geolocation.getCurrentPosition(
                            function(position) {
                                const userLocation = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude
                                };
                                map.setCenter(userLocation);
                                
                                // Add user location marker
                                new google.maps.Marker({
                                    position: userLocation,
                                    map: map,
                                    title: 'Your Location',
                                    icon: {
                                        url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%234285f4"><circle cx="12" cy="12" r="8"/><circle cx="12" cy="12" r="3" fill="white"/></svg>'),
                                        scaledSize: new google.maps.Size(24, 24)
                                    }
                                });
                            },
                            function(error) {
                                console.log('Geolocation error:', error.message);
                                // Keep default location
                            },
                            {
                                enableHighAccuracy: false,
                                timeout: 10000,
                                maximumAge: 300000
                            }
                        );
                    } else if (result.state === 'prompt') {
                        // User will be prompted
                        navigator.geolocation.getCurrentPosition(
                            function(position) {
                                const userLocation = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude
                                };
                                map.setCenter(userLocation);
                                
                                // Add user location marker
                                new google.maps.Marker({
                                    position: userLocation,
                                    map: map,
                                    title: 'Your Location',
                                    icon: {
                                        url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%234285f4"><circle cx="12" cy="12" r="8"/><circle cx="12" cy="12" r="3" fill="white"/></svg>'),
                                        scaledSize: new google.maps.Size(24, 24)
                                    }
                                });
                            },
                            function(error) {
                                console.log('Geolocation denied or failed:', error.message);
                                // Keep default location
                            },
                            {
                                enableHighAccuracy: false,
                                timeout: 10000,
                                maximumAge: 300000
                            }
                        );
                    }
                    // If denied, silently continue with default location
                }).catch(function(error) {
                    console.log('Permission query failed:', error);
                    // Fallback to default location silently
                });
            }
            
                // Add default location marker for reference
                new google.maps.Marker({
                    position: {lat: 39.94041, lng: -82.00734},
                    map: map,
                    title: 'Muskingum County Courthouse (Default Location)',
                    icon: {
                        url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%23FFD700"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>'),
                        scaledSize: new google.maps.Size(24, 24)
                    }
                });
                
            } catch (error) {
                console.error('Error initializing map:', error);
                const mapDiv = document.getElementById('map');
                mapDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: #e74c3c;"><h3>Map Loading Error</h3><p>' + error.message + '</p><p>Please refresh the page or contact support.</p></div>';
            }
        }

        function startDrawing() {
            drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON);
        }

        function clearPolygon() {
            if (currentPolygon) {
                currentPolygon.setMap(null);
                currentPolygon = null;
                selectedArea = 0;
                updateDisplay();
            }
        }

        function deleteSelected() {
            clearPolygon();
        }

        function calculateArea() {
            if (!currentPolygon) return;

            const area = google.maps.geometry.spherical.computeArea(currentPolygon.getPath());
            selectedArea = area * 10.764; // Convert square meters to square feet
            updateDisplay();
        }

        function updateDisplay() {
            const areaDisplay = document.getElementById('areaDisplay');
            const materialSelect = document.getElementById('material');
            const submitBtn = document.getElementById('submitBtn');

            areaDisplay.textContent = selectedArea.toFixed(2) + ' sq ft';

            if (selectedArea > 0) {
                calculatePrice();
                submitBtn.disabled = false;
            } else {
                // Reset price display
                document.getElementById('materialCost').textContent = '$0.00';
                document.getElementById('laborCost').textContent = '$0.00';
                document.getElementById('equipmentCost').textContent = '$0.00';
                document.getElementById('totalPrice').textContent = '$0.00';
                submitBtn.disabled = true;
            }
        }

        function calculatePrice() {
            const materialSelect = document.getElementById('material');
            const materialType = materialSelect.value;
            const materialPrice = materialPrices[materialType];

            const materialCost = selectedArea * materialPrice;
            const laborCost = selectedArea * 3; // $3 per sq ft for labor
            const equipmentCost = Math.max(200, selectedArea * 0.5); // Minimum $200 or $0.5 per sq ft

            const totalCost = materialCost + laborCost + equipmentCost;

            document.getElementById('materialCost').textContent = '$' + materialCost.toFixed(2);
            document.getElementById('laborCost').textContent = '$' + laborCost.toFixed(2);
            document.getElementById('equipmentCost').textContent = '$' + equipmentCost.toFixed(2);
            document.getElementById('totalPrice').textContent = '$' + totalCost.toFixed(2);
        }

        // Update price when material changes
        document.getElementById('material').addEventListener('change', function() {
            if (selectedArea > 0) {
                calculatePrice();
            }
        });

        // Handle form submission
        document.getElementById('estimateForm').addEventListener('submit', function(e) {
            e.preventDefault();

            if (selectedArea === 0) {
                alert('Please select an area on the map before submitting.');
                return;
            }

            // Collect form data
            const formData = {
                customerName: document.getElementById('customerName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                projectType: document.getElementById('projectType').value,
                material: document.getElementById('material').value,
                notes: document.getElementById('notes').value,
                selectedArea: selectedArea.toFixed(2),
                estimatedPrice: document.getElementById('totalPrice').textContent,
                polygonCoordinates: currentPolygon ? currentPolygon.getPath().getArray().map(coord => ({
                    lat: coord.lat(),
                    lng: coord.lng()
                })) : []
            };

            // Show success message with better formatting
            const successMessage = `üéâ Estimate Request Submitted Successfully!

üìã Project Details:
‚Ä¢ Customer: ${formData.customerName}
‚Ä¢ Project Type: ${formData.projectType.charAt(0).toUpperCase() + formData.projectType.slice(1)}
‚Ä¢ Area: ${formData.selectedArea} sq ft
‚Ä¢ Material: ${formData.material.charAt(0).toUpperCase() + formData.material.slice(1)}
‚Ä¢ Estimated Price: ${formData.estimatedPrice}

‚úÖ We will contact you within 24 hours with a detailed quote!
üìû Questions? Call us at (740) 453-3063`;

            alert(successMessage);

            console.log('Form data:', formData);

            // Submit to local Neff Paving server
            fetch('http://localhost:3001/submit-estimate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('‚úÖ Server response:', data);
                    alert(`üéâ SUCCESS! Your estimate request has been submitted!\n\nüìã Reference Number: ${data.referenceNumber}\n‚è∞ Submitted: ${data.submissionTime}\nüìÖ Date: ${data.submissionDate}\n\n‚úÖ A Neff Paving representative will contact you within 24 hours!\nüìû Questions? Call us at (740) 453-3063`);
                } else {
                    console.error('‚ùå Server error:', data);
                    alert('‚ö†Ô∏è There was an issue submitting your request. Please try again or call us directly at (740) 453-3063.');
                }
            })
            .catch(error => {
                console.error('‚ùå Network error:', error);
                alert('‚ö†Ô∏è Unable to connect to the estimate server. Your data has been saved locally. Please call us at (740) 453-3063 to submit your estimate request.');
            });
        });

        // Map will be initialized by the Google Maps callback
        
        // Fallback check if map doesn't load
        setTimeout(function() {
            if (typeof google === 'undefined' || !google.maps) {
                console.error('Google Maps failed to load after 10 seconds');
                const mapDiv = document.getElementById('map');
                mapDiv.innerHTML = `
                    <div style="padding: 40px; text-align: center; background: #f8f9fa; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                        <h3 style="color: #e74c3c; margin-bottom: 20px;">‚ö†Ô∏è Map Loading Issue</h3>
                        <p style="color: #666; margin-bottom: 20px;">The map is temporarily unavailable. This could be due to:</p>
                        <ul style="text-align: left; color: #666; margin-bottom: 20px;">
                            <li>Internet connectivity issues</li>
                            <li>Browser blocking the Google Maps script</li>
                            <li>API key restrictions</li>
                        </ul>
                        <p style="color: #666;">You can still submit the form with manual area entry, or try refreshing the page.</p>
                        <button onclick="location.reload()" style="padding: 10px 20px; background: #FFD700; color: #2C2C2C; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">Refresh Page</button>
                    </div>
                `;
            }
        }, 10000);
    </script>

    <!-- Google Maps API with Drawing and Geometry libraries -->
    <script 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA7VWDFVhPwWzWrkLxQQ1bktzQvikLoDXk&libraries=drawing,geometry&callback=initMap"
        onerror="console.error('Failed to load Google Maps script'); document.getElementById('map').innerHTML = '<div style=\'padding: 40px; text-align: center; color: #e74c3c;\'>Failed to load Google Maps. Please check your internet connection and try again.</div>';">
    </script>
</body>

</html>